#!/bin/bash
usage() {
	echo "Usage: $0 somedomain.com [container name]"
}
if [ -z $1 ]; then usage; exit 1; fi
domain=$1
container_name=$2
vdomains=$(docker exec -ti $container_name postconf | grep ^virtual_mailbox_domains | awk '{print $NF}');
if ! grep -q "$domain" $vdomains; then
	echo -n "Adding domain $domain to virtual domain configuration file ($vdomains).."
	echo "$domain" >> $vdomains
	echo "done."
	echo "Restart Docker container to reload configuration changes."
else
	echo "Domain $domain already exists in the virtual domain configuration file. Maybe you need to restart the Docker container?"
fi
